# WebServer
### 编译环境：
CentOS7.7、g++4.8.5、gdb 7.9、cmake2.8.12.2、make3.82

* 使用了epoll边缘触发 + 非阻塞IO + EPOLLONESHOT
  EPOLLONESHOT的效果是设置的fd只会被触发一次. 是为了保证同一个client_fd的请求同时只会被一个线程处理.
  1. 多个线程处理同一个httpdata 
     客户端可能会连续发送两个请求,如果线程正在处理第一个请求,这时客户端又来了第二个请求,不设置EPOLLONESHOT就会再次触发而其他线程又是空闲的话, 
     那么其他线程可能也会去处理这个fd对应的httpdata,两个线程访问同一个httpdata,当然不行.
  2. 删除不安全
     fd请求刚被执行完,正在主线程中被删除(还没有从EPOLL实例删除), 他又触发了, 那就会再添加一次任务, 但是又不会马上执行任务(工作线程繁忙).
     之后这个fd的httpData被删除后, 工作线程又去执行任务, 那么执行任务时访问的httpData数据是空的, 就会出现意料之外的错误(段错误或者其它的
     
所以在任务没有执行完之前, httpdata要被一个工作线程独占, 要防止其他线程修改它.
     
* 使用了一个固定线程数的线程池(单例模式)
* 使用锁的地方
  * 实现一个连接队列, 处理客户端请求, 及返回响应 
  * 实现一个任务队列, 线程池处理任务
* 状态机解析HTTP报文, 支持get、post请求，支持长短连接
