# WebServer
自己写的http服务器

## 编译环境：
CentOS 8.8;   g++ 8.3.1;   gdb 8.2;  cmake 3.11.4;  make 4.2.1

目录结构：

| include | src | conf | log | htdocs |
| ---- | ---- | ---- | ---- | ---- |
| 头文件 | 源文件 | 配置文件 | 日志文件 | 前端静态界面 | 

## 构建方法
```shell
mkdir build
cd build
cmake ../
make
```
至此就可以得到一个WebServer的可执行文件


* 使用了epoll边缘触发 + 非阻塞IO + EPOLLONESHOT
  EPOLLONESHOT的效果是设置的fd只会被触发一次. 是为了保证同一个client_fd的请求同时只会被一个线程处理.
  1. 多个线程处理同一个httpdata 
     客户端可能会连续发送两个请求,如果线程正在处理第一个请求,这时客户端又来了第二个请求,不设置EPOLLONESHOT就会再次触发而其他线程又是空闲的话, 
     那么其他线程可能也会去处理这个fd对应的httpdata,两个线程访问同一个httpdata,当然不行.
  2. 删除不安全
     fd请求刚被执行完,正在主线程中被删除(还没有从EPOLL实例删除), 他又触发了, 那就会再添加一次任务, 但是又不会马上执行任务(工作线程繁忙).
     之后这个fd的httpData被删除后, 工作线程又去执行任务, 那么执行任务时访问的httpData数据是空的, 就会出现意料之外的错误(段错误或者其它的
     
所以在任务没有执行完之前, httpdata要被一个工作线程独占, 要防止其他线程修改它.
     
* 使用锁的地方
  * 实现一个连接队列, 处理客户端请求, 及返回响应 
  * 实现一个任务队列, 线程池处理任务

### 注意点
errno是线程安全的, 可以在多线程使用, POSIX线程将他定义成了宏

### 改进点
1. 线程池有时间需要重写,这个感觉还是不太好,可以尝试一下信号量+互斥量。另外最好实现成动态线程池。
2. 配置系统最好重新写一个,现在这个只是在读文件而已。
3. 日志系统再研究研究。


